# クライアント環境構築手順書

**作成日**: 2025-10-06
**対象**: ナレッジ共有基盤システム v4.0
**実施者**: クライアントのGoogleアカウント管理者

---

## 📋 概要

自社環境でテスト完了したシステムを、クライアント環境に構築します。

**所要時間**: 約20分

---

## 🎯 事前準備

### 必要なもの

✅ **クライアントのGoogleアカウント**
- Google Workspace または 個人アカウント
- Google Drive、Google Forms、Apps Scriptの利用権限

✅ **Gemini APIキー（クライアント用）**
- https://aistudio.google.com/app/apikey
- クライアントのGoogleアカウントで作成
- 無料枠: 1,000回/日、30,000回/月

✅ **実装ファイル（GitHubから取得）**
- https://github.com/kshoda-lgtm/8CUBE-promotion
- `Create_Form.js` - Form自動作成スクリプト
- `Integrated_Form_to_Markdown.js` - 処理スクリプト（修正版）

---

## 📝 実装手順

### ステップ1: Gemini APIキーの取得

**⚠️ 必ずクライアントのGoogleアカウントで実施**

1. **Google AI Studioにアクセス**
   ```
   https://aistudio.google.com/app/apikey
   ```

2. **「Create API key in new project」をクリック**
   - 新しいプロジェクトで作成
   - 数秒で生成される

3. **APIキーをコピーして保存**
   ```
   AIza... で始まる文字列
   例: AIzaSyABC123...XYZ
   ```

4. **安全に保管**
   - パスワード管理ツールに保存
   - スクリーンショット共有は避ける

---

### ステップ2: Markdown保存用フォルダの作成

1. **Google Driveを開く**
   ```
   https://drive.google.com/
   ```

2. **新しいフォルダを作成**
   - フォルダ名: `ナレッジ共有基盤_Markdown`
   - または任意の名前

3. **フォルダIDをコピー**
   - フォルダを開く
   - URLから ID をコピー
   ```
   https://drive.google.com/drive/folders/【ここがID】
   例: 1xpcx0vEnlvo4LlCQpeOM6RtYtRsz_RYh
   ```

---

### ステップ3: Google Formの作成

1. **Apps Scriptを開く**
   ```
   https://script.google.com/
   ```

2. **新しいプロジェクトを作成**
   - 「新しいプロジェクト」をクリック
   - プロジェクト名: `ナレッジ共有基盤 - Form作成ツール`

3. **スクリプトをコピペ**
   - GitHubから `Create_Form.js` を開く
   - https://github.com/kshoda-lgtm/8CUBE-promotion/blob/main/promotion%E9%83%A8/Create_Form.js
   - 全てコピーして、Apps Scriptに貼り付け

4. **保存**（Ctrl+S）

5. **関数を実行**
   - 関数選択: `createKnowledgeForm`
   - 「実行」ボタンをクリック

6. **権限の承認**
   - 「権限を確認」
   - Googleアカウントを選択
   - 「詳細」→「(プロジェクト名)に移動」
   - 「許可」

7. **実行ログを確認**
   - 「実行数」→ 最新のログを開く
   - Form URLとForm IDをコピー
   ```
   📋 Form URL: https://docs.google.com/forms/d/e/1FAIpQL.../viewform
   🔗 Form ID: 1XxpcehZiC32Tg-WBROTk88-9Dsq5cdLbdFixOYoguCk
   ```

8. **Form URLとForm IDを保存**
   - 後で使用します

---

### ステップ4: 処理スクリプトの設定

1. **Formの編集画面を開く**
   - ステップ3で取得した Form URL の `/viewform` を `/edit` に変更
   ```
   例: https://docs.google.com/forms/d/.../edit
   ```

2. **スクリプトエディタを開く**
   - 右上「⋮」（3点メニュー）→「スクリプトエディタ」

3. **Code.gsの内容を全て削除**

4. **処理スクリプトをコピペ**
   - GitHubから `Integrated_Form_to_Markdown.js`（修正版）を開く
   - 全てコピーして、Apps Scriptに貼り付け
   - **⚠️ 注意**: 本番環境用の修正版を使用すること

5. **保存**（Ctrl+S）

---

### ステップ5: スクリプトプロパティの設定

1. **Apps Scriptで左メニュー「⚙️ プロジェクトの設定」をクリック**

2. **下にスクロール → 「スクリプト プロパティ」セクション**

3. **「スクリプト プロパティを追加」を2回クリック**

4. **以下の2つを設定:**

   **1つ目:**
   ```
   プロパティ: OUTPUT_FOLDER_ID
   値: (ステップ2で取得したフォルダID)
   例: 1xpcx0vEnlvo4LlCQpeOM6RtYtRsz_RYh
   ```

   **2つ目:**
   ```
   プロパティ: GEMINI_API_KEY
   値: (ステップ1で取得したAPIキー)
   例: AIzaSyABC123...XYZ
   ```

5. **「スクリプト プロパティを保存」をクリック**

---

### ステップ6: トリガーの設定

1. **Apps Scriptで左メニュー「⏰ トリガー」をクリック**

2. **右下「+ トリガーを追加」をクリック**

3. **以下の設定:**
   ```
   実行する関数を選択: onFormSubmit
   実行するデプロイを選択: Head
   イベントのソースを選択: フォームから
   イベントの種類を選択: フォーム送信時
   ```

4. **「保存」をクリック**

5. **権限の承認**
   - 「権限を確認」
   - Googleアカウントを選択
   - 「詳細」→「(プロジェクト名)に移動」
   - 「許可」

---

### ステップ7: テスト実行（手動入力）

1. **Formにアクセス**
   - ステップ3で取得した Form URL

2. **テストデータを入力:**
   ```
   データ入力方法: 手動で情報を入力

   クライアント名: テスト株式会社
   イベント種別: 提案書
   実施時期: 2025年3月
   イベント内容: システム動作確認テスト
   会場: テスト会場
   ターゲット人数: 100
   単価: 500
   総費用: 50000
   発注数量: 100
   納期: 7営業日
   協力会社: テスト協力会社
   ノベルティ: テストノベルティ
   キーワード: テスト,動作確認

   通知先メールアドレス: (クライアントのメールアドレス)
   ```

3. **「送信」をクリック**

4. **確認事項:**
   - ✅ メールが届く（5-10秒以内）
   - ✅ Google Driveにファイルが作成される
   - ✅ Apps Script実行ログにエラーがない

---

### ステップ8: NotebookLMでの動作確認

1. **NotebookLMにアクセス**
   ```
   https://notebooklm.google.com/
   ```

2. **新しいノートブックを作成**

3. **生成されたMarkdownファイルをアップロード**
   - Google Driveからダウンロード
   - NotebookLMにドラッグ&ドロップ

4. **質問してテスト:**
   ```
   「テスト株式会社の案件内容を教えて」
   「単価はいくらですか？」
   ```

5. **正しく回答されればOK！**

---

## ✅ 完成後の確認

### システムが正常動作していることを確認

- [ ] Formが正しく表示される
- [ ] Form送信時にエラーが出ない
- [ ] メール通知が届く
- [ ] Google DriveにMarkdownファイルが作成される
- [ ] Markdownの内容が正しい
- [ ] NotebookLMで情報を検索できる

---

## 🔒 セキュリティ設定

### Gemini APIキーの管理

**✅ やること:**
- スクリプトプロパティに安全に保存
- パスワード管理ツールでバックアップ

**❌ やらないこと:**
- GitHubにコミット
- メールで送信
- スクリーンショット共有

### Form URLの共有範囲

**組織内限定にする場合:**
1. Formの設定 → 「回答」タブ
2. 「〇〇組織内のユーザーに限定する」をON

---

## 📊 無料枠の管理

### Gemini API使用状況の確認

**制限:**
- 日次: 1,000回/日
- 月次: 30,000回/月

**確認方法:**
- Google Cloud Console
- https://console.cloud.google.com/

**超過時:**
- 自動停止（課金なし）
- 翌日/翌月に再開

---

## 🆘 トラブルシューティング

### Q1: Formが作成できない

**原因:**
- プロジェクト作成上限に達している（25個）

**対処:**
- 不要な古いプロジェクトを削除
- または別のGoogleアカウントで試す

---

### Q2: メールが届かない

**確認事項:**
- スクリプトプロパティが正しく設定されているか
- トリガーが設定されているか
- Apps Scriptの実行ログにエラーがないか

**対処:**
- Apps Script → 「実行数」→ ログを確認
- エラーメッセージを確認

---

### Q3: PowerPoint自動抽出が動かない

**確認事項:**
- GEMINI_API_KEYが設定されているか
- PowerPointがGoogle Slidesに変換されているか
- Google DriveのリンクURLが正しいか

**対処:**
- PowerPointをGoogle Driveで開く
- 「Google Slidesで開く」→ 変換
- 変換後のGoogle SlidesのリンクをFormに貼る

---

### Q4: 無料枠を使い切った

**対処:**
- 翌日まで待つ（日次制限の場合）
- 翌月まで待つ（月次制限の場合）
- **課金は発生しません**（自動停止）

---

## 📞 サポート

**詳細な仕様:**
- ナレッジ共有基盤_無料版仕様書.md
- 統合Google_Form設計.md
- 実装・テスト手順書.md

**GitHubリポジトリ:**
- https://github.com/kshoda-lgtm/8CUBE-promotion

---

## 📝 チェックリスト

### 構築前

- [ ] クライアントのGoogleアカウントを準備
- [ ] Gemini APIキーを取得
- [ ] Markdown保存用フォルダを作成
- [ ] GitHubから最新ファイルを取得

### 構築中

- [ ] Form作成スクリプトを実行
- [ ] Form URLとForm IDを保存
- [ ] 処理スクリプトをFormに設定
- [ ] スクリプトプロパティを設定（2つ）
- [ ] トリガーを設定

### 構築後

- [ ] 手動入力でテスト実行
- [ ] メール通知を確認
- [ ] Markdownファイルを確認
- [ ] NotebookLMで動作確認
- [ ] PowerPoint自動抽出もテスト（オプション）

### 運用準備

- [ ] 職員向けマニュアルを作成
- [ ] Form URLを共有
- [ ] NotebookLMの使い方を説明
- [ ] 定期的な無料枠確認体制を確立

---

## 🎯 次のステップ

### クライアント環境での実施

1. この手順書をもとに、クライアントのアカウントで構築
2. ステップ1から順番に実施
3. 各ステップで取得した情報（URL、ID）を記録
4. 完成後、職員さんに使い方を説明

### 運用開始

- Form URLを職員さんに共有
- 初回は一緒に操作して確認
- NotebookLMの活用方法を教育
- 月次で使用状況をレポート

---

**株式会社エイトキューブ プロモーション事業部**
**ナレッジ共有基盤システム v4.0**
