# ナレッジ共有基盤システム - 実装・テスト手順書

**バージョン**: v4.0
**最終更新**: 2025-10-06
**対象**: NotebookLM連携型ハイブリッドナレッジ収集システム

---

## 📋 目次

1. [テスト環境構築（自社API使用）](#1-テスト環境構築自社api使用)
2. [テスト実行手順](#2-テスト実行手順)
3. [本番環境構築（クライアントAPIに切り替え）](#3-本番環境構築クライアントapiに切り替え)
4. [運用手順](#4-運用手順)
5. [トラブルシューティング](#5-トラブルシューティング)

---

## 1. テスト環境構築（自社API使用）

### 1-1. 前提条件

- Python 3.8以上がインストール済み
- Googleアカウント（会社のメインアカウント）
- PowerPointファイルのサンプルデータ

### 1-2. Gemini APIキー取得（自社用）

**⚠️ 重要: テスト用は会社のアカウントで作成**

1. **Google AI Studioにアクセス**
   https://aistudio.google.com/app/apikey

2. **APIキーを作成**
   - 「Create API key」をクリック
   - 既存のプロジェクトを選択 または 「Create API key in new project」
   - APIキーをコピー（`AIza...` で始まる文字列）

3. **APIキーを保存**
   ```bash
   # テスト用APIキーをメモ帳などに保存
   # 例: AIzaSyABC123...XYZ
   ```

### 1-3. Python環境のセットアップ

```bash
# 1. 必要なライブラリをインストール
pip install python-pptx google-generativeai

# 2. インストール確認
python -c "import pptx; import google.generativeai as genai; print('OK')"
```

### 1-4. APIキーの設定（テスト用）

**Windows（PowerShell）:**
```powershell
# 一時的に設定（このセッションのみ有効）
$env:GEMINI_API_KEY="your-company-api-key-here"

# 確認
echo $env:GEMINI_API_KEY
```

**Windows（コマンドプロンプト）:**
```cmd
set GEMINI_API_KEY=your-company-api-key-here
```

**Mac/Linux:**
```bash
export GEMINI_API_KEY="your-company-api-key-here"
```

---

## 2. テスト実行手順

### 2-1. 単一ファイルのテスト

**目的**: 1つのPowerPointファイルでMarkdown生成をテスト

```bash
# promotion部ディレクトリに移動
cd promotion部

# テスト実行
python markdown_generator.py "テストファイル.pptx"
```

**期待される出力:**
```
============================================================
PowerPoint → Markdown 変換（NotebookLM用）
============================================================

📊 FREE TIER USAGE STATUS:
   Today: 1/1,000 requests (残り 999)
   This month: 1/30,000 requests (残り 29,999)
   Total: 1 requests

Processing: テストファイル.pptx
  Slide 1/10: 5 text blocks extracted
  ...
  Sending to Gemini API...
  Gemini API analysis completed (confidence: 85%)

✅ JSON保存: テストファイル.json
✅ Markdown生成完了: テストファイル.md
```

**確認事項:**
- [ ] `.json` ファイルが生成されている
- [ ] `.md` ファイルが生成されている
- [ ] 信頼度スコアが60%以上
- [ ] クライアント名が正しく抽出されている

### 2-2. Markdownファイルの内容確認

```bash
# Markdownファイルを開く
notepad テストファイル.md  # Windows
open テストファイル.md     # Mac
```

**確認項目:**
- [ ] クライアント名が抽出されている
- [ ] イベント種別が正しい
- [ ] 価格情報が含まれている
- [ ] タグ・キーワードが適切

### 2-3. バッチ処理のテスト

**目的**: 複数ファイルを一括処理

```bash
# テスト用フォルダを作成
mkdir test_batch
# フォルダに2-3個のPowerPointファイルをコピー

# バッチ処理実行
python batch_markdown_generator.py "test_batch"
```

**確認事項:**
- [ ] 全ファイルが処理された
- [ ] エラーなく完了した
- [ ] 無料枠の使用量が正しく記録されている

### 2-4. NotebookLMでの動作確認

1. **NotebookLMにアクセス**
   https://notebooklm.google.com/

2. **新しいノートブックを作成**
   - 「新しいノートブック」をクリック

3. **Markdownファイルをアップロード**
   - 生成された `.md` ファイルを2-3個アップロード
   - 「ソースを追加」→ ファイルを選択

4. **動作確認の質問例:**
   ```
   「〇〇様のイベント内容を教えて」
   「単価はいくらですか？」
   「協力会社はどこですか？」
   ```

**確認事項:**
- [ ] NotebookLMがファイルを読み込めた
- [ ] 質問に対して適切な回答が得られる
- [ ] 過去案件の検索ができる

---

## 3. 本番環境構築（クライアントAPIに切り替え）

### 3-1. クライアント用Gemini APIキー取得

**⚠️ 重要: 本番用はクライアントのGoogleアカウントで作成**

1. **クライアントのGoogleアカウントでログイン**

2. **Google AI Studioにアクセス**
   https://aistudio.google.com/app/apikey

3. **APIキーを作成**
   - 「Create API key」をクリック
   - 「Create API key in new project」を選択
   - APIキーをコピー

4. **クライアントにAPIキーを共有してもらう**
   - セキュアな方法で受け取る（メール添付は避ける）

### 3-2. APIキーの切り替え

**テスト環境のAPIキーを削除:**
```bash
# 環境変数をクリア
unset GEMINI_API_KEY  # Mac/Linux
$env:GEMINI_API_KEY=""  # PowerShell
set GEMINI_API_KEY=  # コマンドプロンプト
```

**本番用APIキーを設定:**
```bash
# クライアントのAPIキーを設定
export GEMINI_API_KEY="client-api-key-here"  # Mac/Linux
$env:GEMINI_API_KEY="client-api-key-here"  # PowerShell
set GEMINI_API_KEY=client-api-key-here  # コマンドプロンプト
```

**⚠️ セキュリティ注意事項:**
- APIキーをGitにコミットしない
- APIキーをスクリーンショット共有しない
- 定期的にAPIキーをローテーションする

### 3-3. 本番データで動作確認

```bash
# 本番のPowerPointファイルで1件テスト
python markdown_generator.py "本番ファイル.pptx"

# 使用量を確認
cat ~/.gemini_usage.json  # Mac/Linux
type %USERPROFILE%\.gemini_usage.json  # Windows
```

**確認事項:**
- [ ] クライアントのAPIキーで正常に動作
- [ ] 使用量がクライアントのアカウントで記録されている
- [ ] エラーが発生しない

---

## 4. 運用手順

### 4-1. PowerPointファイルからMarkdown生成

**日常業務フロー:**

```bash
# 1. 新しい案件のPowerPointファイルを受領

# 2. promotion部ディレクトリに移動
cd promotion部

# 3. 単一ファイル処理
python markdown_generator.py "案件名.pptx"

# または複数ファイル一括処理
python batch_markdown_generator.py "案件フォルダ"

# 4. 生成された.mdファイルをNotebookLMにアップロード
```

### 4-2. Google Formからの手動入力

**PowerPointがない案件の場合:**

1. **Google Formにアクセス**
   - フォームURLを開く
   - 案件情報を入力

2. **自動でMarkdownが生成される**
   - `Form_to_Markdown.js` が自動実行
   - Google Driveの指定フォルダに保存

3. **NotebookLMにアップロード**
   - 生成された `.md` ファイルをダウンロード
   - NotebookLMにアップロード

### 4-3. 無料枠の管理

**使用状況の確認:**
```bash
# 使用ログファイルを確認
cat ~/.gemini_usage.json
```

**出力例:**
```json
{
  "daily": {
    "2025-10-06": 45
  },
  "monthly": {
    "2025-10": 1234
  },
  "total": 1234
}
```

**制限:**
- 日次: 1,000回/日
- 月次: 30,000回/月

**超過時の動作:**
- システムが自動停止
- 課金は発生しない

### 4-4. NotebookLMの活用

**推奨される使い方:**

1. **過去案件の検索**
   ```
   「広研様に似た案件はありますか？」
   「エコバッグの過去の単価を教えて」
   ```

2. **協力会社の評価**
   ```
   「A社との協力実績を教えて」
   「対応が良かった協力会社は？」
   ```

3. **成功・失敗パターンの学習**
   ```
   「過去にうまくいった成功要因は？」
   「よくある失敗パターンは？」
   ```

---

## 5. トラブルシューティング

### Q1: APIキーエラーが出る

**エラー:**
```
ValueError: Gemini API key is required
```

**解決策:**
```bash
# 環境変数が設定されているか確認
echo $GEMINI_API_KEY  # Mac/Linux
echo %GEMINI_API_KEY%  # Windows

# 設定されていない場合は再設定
export GEMINI_API_KEY="your-api-key"
```

### Q2: 無料枠を使い切った

**エラー:**
```
⚠️  FREE TIER LIMIT EXCEEDED: Daily limit (1,000 requests/day)
```

**解決策:**
- 翌日まで待つ（日次制限の場合）
- 翌月まで待つ（月次制限の場合）
- **課金は発生しません（自動停止）**

### Q3: python-pptxがインストールできない

**解決策:**
```bash
# Pythonのバージョン確認
python --version

# 再インストール
pip uninstall python-pptx
pip install python-pptx
```

### Q4: Markdownの精度が低い

**症状:**
- 信頼度スコアが50%未満
- クライアント名が抽出されない

**解決策:**
1. PowerPointファイルの構造を確認
   - テキストが画像になっていないか
   - 表形式が複雑すぎないか

2. 手動でGoogle Formから入力
   - PowerPointの自動抽出が難しい場合

### Q5: NotebookLMにアップロードできない

**確認事項:**
- ファイルサイズが大きすぎないか（1ファイル5MB以下推奨）
- ファイル形式が `.md` になっているか
- NotebookLMのストレージ容量が残っているか

### Q6: 会社のAPIとクライアントのAPIを間違えた

**症状:**
- テスト中にクライアントのAPIを使ってしまった
- 本番で会社のAPIを使ってしまった

**対処:**
```bash
# 現在のAPIキーを確認
echo $GEMINI_API_KEY

# 使用ログを確認
cat ~/.gemini_usage.json

# 正しいAPIキーに切り替え
export GEMINI_API_KEY="correct-api-key"
```

---

## 📞 サポート

**詳細な仕様:**
- `ナレッジ共有基盤_無料版仕様書.md`

**システムファイル:**
- `powerpoint_processor_gemini.py` - Gemini API処理エンジン
- `markdown_generator.py` - Markdown生成
- `batch_markdown_generator.py` - バッチ処理
- `Form_to_Markdown.js` - Google Form連携

---

## ✅ 実装チェックリスト

### テスト段階（自社API使用）

- [ ] Python環境構築完了
- [ ] 自社のGemini APIキー取得完了
- [ ] 環境変数に自社APIキーを設定
- [ ] 単一ファイルテスト成功
- [ ] バッチ処理テスト成功
- [ ] NotebookLMでの動作確認完了
- [ ] 無料枠の使用量確認方法を理解

### 本番段階（クライアントAPI使用）

- [ ] クライアントのGemini APIキー取得
- [ ] 環境変数をクライアントAPIに切り替え
- [ ] 本番データでテスト実行
- [ ] 使用量がクライアントアカウントで記録されることを確認
- [ ] Google Form連携を設定（必要に応じて）
- [ ] NotebookLMにMarkdownファイルをアップロード
- [ ] クライアントに使用方法を説明

### 運用段階

- [ ] 定期的に無料枠の使用量を確認
- [ ] 月次レポートを作成（何件処理したか）
- [ ] NotebookLMの活用方法をクライアントに教育
- [ ] トラブル発生時の対応フローを確立

---

**株式会社エイトキューブ プロモーション事業部**
**ナレッジ共有基盤システム v4.0**
